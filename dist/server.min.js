"use strict";var express=require("express"),mongoose=require("mongoose"),Ably=require("ably"),cors=require("cors"),app=express(),port=process.env.PORT||3e3;mongoose.connect("mongodb+srv://sneha321:sneha321@cluster0.nl9gh.mongodb.net/chatApp?retryWrites=true&w=majority&appName=Cluster0",{useNewUrlParser:!0,useUnifiedTopology:!0}).then(function(){return console.log("MongoDB connected")}).catch(function(e){return console.log(e)});var messageSchema=new mongoose.Schema({text:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}),Message=mongoose.model("Message",messageSchema);app.use(express.json()),app.use(cors());var ably=new Ably.Realtime({key:"YOUR_ABLY_API_KEY"}),publicChannel=ably.channels.get("chat");publicChannel.subscribe("message",function(s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Message({text:s.data.text}),e.next=3,regeneratorRuntime.awrap(t.save());case 3:console.log("Message saved to DB:",s.data.text);case 4:case"end":return e.stop()}})}),app.get("/messages",function(e,s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Message.find().sort({timestamp:-1}));case 3:t=e.sent,s.json(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),s.status(500).json({error:"Failed to fetch messages"});case 10:case"end":return e.stop()}},null,null,[[0,7]])}),app.use(express.static("public")),app.listen(port,function(){console.log("Server running on port ".concat(port))});
//# sourceMappingURL=server.min.js.map
